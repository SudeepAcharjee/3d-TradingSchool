var pe=Object.defineProperty,fe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var R=(c,p,w)=>p in c?pe(c,p,{enumerable:!0,configurable:!0,writable:!0,value:w}):c[p]=w,U=(c,p)=>{for(var w in p||(p={}))me.call(p,w)&&R(c,w,p[w]);if(X)for(var w of X(p))ve.call(p,w)&&R(c,w,p[w]);return c},L=(c,p)=>fe(c,_e(p));var M=(c,p,w)=>(R(c,typeof p!="symbol"?p+"":p,w),w);(function(c,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],p):(c=typeof globalThis!="undefined"?globalThis:c||self,p(c["three-nodetoy"]={},c.h))})(this,function(c,p){"use strict";function w(r){if(r&&r.__esModule)return r;var e={__proto__:null,[Symbol.toStringTag]:"Module"};return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,Object.freeze(e)}var s=w(p),H=Object.defineProperty,Q=(r,e,t)=>e in r?H(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,b=(r,e,t)=>(Q(r,typeof e!="symbol"?e+"":e,t),t);const Z=(r,e={})=>{A("event",r,e)},J=(r,e={})=>{if(typeof window>"u")return;const t="ga-gtag";if(document.getElementById(t)){console.error("Already has a gtag script.");return}const{head:n}=document,i=document.createElement("script");i.id=t,i.type="text/javascript",i.async=!0,i.src=`https://www.googletagmanager.com/gtag/js?id=${r}`,n.insertBefore(i,n.firstChild),window.dataLayer=window.dataLayer||[],A("js",new Date),A("config",r,e)},A=function(...r){window.dataLayer.push(arguments)},ee=new s.TextureLoader,N={},f={state:0,stateFrame:0,button:0,viewportState:0,viewportStateFrame:0,x:0,y:0};class te extends s.DataTexture{constructor(){const e=new Uint8Array(1024);for(let t=0;t<4*256;t++)e[t]=0;super(e,256,1,s.RGBAFormat);b(this,"data"),b(this,"_size"),this.data=e,this.flipY=!0,this._size=256}setKeyDown(e){const t=e*4;this.data[t+0]!==255&&(this.data[t+0]=255,this.data[t+1]=255,this.data[t+2]=255-this.data[t+2],this.needsUpdate=!0)}setKeyUp(e){const t=e*4;this.data[t+0]=0,this.data[t+1]=0,this.needsUpdate=!0}clear(){for(let e=0;e<4*this._size;e++)this.data[e]=0;this.needsUpdate=!0}clearFrame(){for(let e=0;e<this._size;e++){const t=e*4;this.data[t+1]=0}this.needsUpdate=!0}}class re{constructor(e){b(this,"renderer"),b(this,"_keyboardTexture",new te),b(this,"_onPointerMoveBind"),b(this,"_onPointerDownBind"),b(this,"_onPointerUpBind"),b(this,"_onPointerEnterBind"),b(this,"_onPointerLeaveBind"),b(this,"_onKeyDownBind"),b(this,"_onKeyUpBind"),this.renderer=e,this.renderer._pointerPosition={x:0,y:0},this.renderer._pointerData=f,this.renderer._keyboardTexture=this._keyboardTexture;const t=e.domElement;if(!t){console.warn("[NodeToy] Unable to bind dom events, domElement is null. Some nodes will not work.");return}this._onPointerMoveBind=this.onPointerMove.bind(this),this._onPointerDownBind=this.onPointerDown.bind(this),this._onPointerUpBind=this.onPointerUp.bind(this),this._onPointerEnterBind=this.onPointerEnter.bind(this),this._onPointerLeaveBind=this.onPointerLeave.bind(this),this._onKeyDownBind=this.onKeyDown.bind(this),this._onKeyUpBind=this.onKeyUp.bind(this),t.addEventListener("pointermove",this._onPointerMoveBind),t.addEventListener("pointerdown",this._onPointerDownBind),t.addEventListener("pointerup",this._onPointerUpBind),t.addEventListener("pointerenter",this._onPointerEnterBind),t.addEventListener("pointerleave",this._onPointerLeaveBind),window.addEventListener("keydown",this._onKeyDownBind),window.addEventListener("keyup",this._onKeyUpBind)}dispose(){if(!this.renderer)return;const e=this.renderer.domElement;!e||(e.removeEventListener("pointermove",this._onPointerMoveBind),e.removeEventListener("pointerdown",this._onPointerDownBind),e.removeEventListener("pointerup",this._onPointerUpBind),e.removeEventListener("pointerenter",this._onPointerEnterBind),e.removeEventListener("pointerleave",this._onPointerLeaveBind),window.removeEventListener("keydown",this._onKeyDownBind),window.removeEventListener("keyup",this._onKeyUpBind))}onPointerMove(e){!this.renderer||(this.renderer._pointerPosition={x:Math.floor(e.offsetX),y:Math.floor(e.offsetY)})}onPointerDown(e){!this.renderer||(this.renderer._pointerData=L(U({},this.renderer._pointerData),{state:1,stateFrame:1,button:e.button,x:Math.floor(e.offsetX),y:Math.floor(e.offsetY)}))}onPointerUp(e){!this.renderer||(this.renderer._pointerData=L(U({},this.renderer._pointerData),{state:2,stateFrame:2,button:e.button,x:Math.floor(e.offsetX),y:Math.floor(e.offsetY)}))}onPointerEnter(e){!this.renderer||(this.renderer._pointerData=L(U({},this.renderer._pointerData),{viewportState:1,viewportStateFrame:1,x:Math.floor(e.offsetX),y:Math.floor(e.offsetY)}))}onPointerLeave(e){!this.renderer||(this.renderer._pointerData=L(U({},this.renderer._pointerData),{viewportState:2,viewportStateFrame:2,x:Math.floor(e.offsetX),y:Math.floor(e.offsetY)}))}onKeyDown(e){!this.renderer||this._keyboardTexture.setKeyDown(e.keyCode)}onKeyUp(e){!this.renderer||this._keyboardTexture.setKeyUp(e.keyCode)}}const ie=r=>r.includes(".json")?r:`${r}${r[r.length-1]!="/"?"/":""}material.glsl.json`,ne=(r,e)=>{if(!r||!e.includes("asset:"))return e;const t=r[r.length-1];return`${r}${t!=="/"?"/":""}assets/${e.replace("asset:","")}`},B=(r,e,t,n={})=>{const i=e;for(let a=0;a<t.length;a++){const m=t[a],h=m.name in n?n[m.name]:m.value;i[m.name]={value:z(r,m.type,h),type:m.type}}return i},z=(r,e,t)=>{switch(e){case"int":case"float":return t;case"vec2":return t!=null?new s.Vector2(t.x,t.y):new s.Vector2(0,0);case"vec3":return t!=null?new s.Vector3(t.x,t.y,t.z):new s.Vector3(0,0,0);case"vec4":return t!=null?new s.Vector4(t.x,t.y,t.z,t.w):new s.Vector4(0,0,0);case"mat3":return t||new s.Matrix3;case"mat4":return t||new s.Matrix4;case"texture":{if(t in N)return N[t];const n=ee.load(ne(r,t));return n.wrapS=n.wrapT=s.RepeatWrapping,N[t]=n,n}}return"undefined"},oe=()=>{J("G-D7559MFFX3")},ae=(r,e)=>{for(let t=0;t<r.scene.children.length;t++)if(r.scene.children[t].isDirectionalLight){r.light=r.scene.children[t];break}if("_sinTime"in e){const t=Math.sin(r.time);e._sinTime.value.set(t/8,t/4,t/2,t)}if("_cosTime"in e){const t=Math.cos(r.time);e._cosTime.value.set(t/8,t/4,t/2,t)}if("_objectScale"in e){const t=r.object;e._objectScale.value=t.scale}if("_time"in e&&(e._time.value=r.time),"_deltaTime"in e&&e._deltaTime.value.set(r.deltaTime,1/r.deltaTime,0,0),"_objectSpaceViewDir"in e){const t=r.object,n=r.camera,i=new s.Vector4(n.position.x,n.position.y,n.position.z),a=t.matrixWorld.clone().invert().elements,m=a[0]*i.x+a[4]*i.y+a[8]*i.z+a[12]*i.w,h=a[1]*i.x+a[5]*i.y+a[9]*i.z+a[13]*i.w,o=a[2]*i.x+a[6]*i.y+a[10]*i.z+a[14]*i.w,l=a[3]*i.x+a[7]*i.y+a[11]*i.z+a[15]*i.w,d=new s.Vector4(m,h,o,l);e._objectSpaceViewDir.value=d}if("_cameraPosition"in e){const t=r.camera;e._cameraPosition.value=t.position.clone()}if("_worldSpaceCameraPosition"in e&&(r.camera.getWorldDirection(K),e._worldSpaceCameraPosition.value=K),"_worldSpaceLightPosition"in e&&(r.light.getWorldDirection(I),e._worldSpaceLightPosition.value=I),"_worldToObject"in e){const t=r.object;e._worldToObject.value=t.matrixWorld.clone().invert()}if("_worldToObjMatrix"in e&&(e._worldToObjMatrix.value=r.object.matrixWorld.clone().invert()),"_worldToCameraMatrix"in e){const t=r.camera;e._worldToCameraMatrix.value=t.matrixWorldInverse.clone()}if("_viewProjectionMatrix"in e){const t=r.camera,n=t.matrixWorld.clone();e._viewProjectionMatrix.value=t.projectionMatrix.clone().multiply(n)}if("_viewMatrix"in e){const t=r.camera;e._viewMatrix.value=t.matrixWorldInverse}if("_transposeModelViewMatrix"in e){const t=r.object;e._transposeModelViewMatrix.value=t.modelViewMatrix.clone().transpose()}if("_inverseTransposeModelViewMatrix"in e){const t=r.object.modelViewMatrix.clone();e._inverseTransposeModelViewMatrix.value=t.invert().transpose()}if("_projectionMatrix"in e){const t=r.camera;e._projectionMatrix.value=t.projectionMatrix}if("_projectionParams"in e){const t=r.camera;e._projectionParams.value=new s.Vector4(1,t.near,t.far,1/t.far)}if("_inverseProjectionMatrix"in e){const t=r.camera;e._inverseProjectionMatrix.value=t.projectionMatrixInverse}if("_objectToWorldMatrix"in e){const t=r.object;e._objectToWorldMatrix.value=t.matrixWorld}if("_modelViewProjectionMatrix"in e){const t=r.object,n=r.camera;n.updateMatrixWorld(!0),t.updateMatrixWorld(!0);const i=t.modelViewMatrix.clone();e._modelViewProjectionMatrix.value=n.projectionMatrix.clone().multiply(i)}if("_modelViewMatrix"in e){const t=r.object;r.camera.updateMatrixWorld(!0),t.updateMatrixWorld(!0),e._modelViewMatrix.value=t.modelViewMatrix.clone()}if("_inverseModelViewMatrix"in e){const t=r.object;r.camera.updateMatrixWorld(!0),t.updateMatrixWorld(!0),e._inverseModelViewMatrix.value=t.modelViewMatrix.clone().invert()}if("_modelMatrix"in e){const t=r.object;e._modelMatrix.value=t.matrixWorld}if("_normalMatrix"in e){const t=r.object;e._normalMatrix.value=t.normalMatrix}if("_inverseViewMatrix"in e){const t=r.camera;e._inverseViewMatrix.value=t.matrixWorldInverse.clone().invert()}if("_cameraToWorldMatrix"in e){const t=r.camera;e._cameraToWorldMatrix.value=t.matrixWorldInverse.clone().invert()}if("_worldSpaceLightDir"in e&&r.light&&(e._worldSpaceLightDir.value=new s.Vector3(r.light.rotation._x,r.light.rotation._y,r.light.rotation._z).normalize()),"_lightColor"in e&&r.light){const t=r.light.intensity,n=new s.Vector3(r.light.color.r*t,r.light.color.g*t,r.light.color.b*t);e._lightColor.value=n}if("_screenSize"in e&&(r.renderer.getSize(D),e._screenSize.value.set(Math.floor(D.x),Math.floor(D.y),1+1/Math.floor(D.x),1+1/Math.floor(D.y))),"_viewDir"in e&&(r.camera.getWorldDirection(V),V.negate(),e._viewDir.value=V),"_pointerPosition"in e){const t="_pointerPosition"in r.renderer?r.renderer._pointerPosition:{x:0,y:0};e._pointerPosition.value.set(Math.floor(t.x),Math.floor(t.y))}if("_pointerPositionNormalized"in e){r.renderer.getSize(D);const t="_pointerPosition"in r.renderer?r.renderer._pointerPosition:{x:0,y:0};e._pointerPositionNormalized.value.set(t.x/D.x,t.y/D.y)}if("_pointerDown"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerDown.value.set(t.state===1?1:0,t.button)}if("_pointerDownPrimary"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===0&&e._pointerDownPrimary.value.set(t.state===1?1:0,t.button)}if("_pointerDownAuxiliary"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===1&&e._pointerDownAuxiliary.value.set(t.state===1?1:0,t.button)}if("_pointerDownSecondary"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===2&&e._pointerDownSecondary.value.set(t.state===1?1:0,t.button)}if("_pointerDownFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerDownFrame.value.set(t.stateFrame===1?1:0,t.button)}if("_pointerDownPrimaryFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===0&&e._pointerDownPrimaryFrame.value.set(t.stateFrame===1?1:0,t.button)}if("_pointerDownAuxiliaryFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===1&&e._pointerDownAuxiliaryFrame.value.set(t.stateFrame===1?1:0,t.button)}if("_pointerDownSecondaryFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===2&&e._pointerDownSecondaryFrame.value.set(t.stateFrame===1?1:0,t.button)}if("_pointerUp"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerUp.value.set(t.state===0||t.state===2?1:0,t.button)}if("_pointerUpPrimary"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===0?e._pointerUpPrimary.value.set(t.state===0||t.state===2?1:0,t.button):e._pointerUpPrimary.value.set(1,t.button)}if("_pointerUpAuxiliary"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===1?e._pointerUpAuxiliary.value.set(t.state===0||t.state===2?1:0,t.button):e._pointerUpAuxiliary.value.set(1,t.button)}if("_pointerUpSecondary"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===2?e._pointerUpSecondary.value.set(t.state===0||t.state===2?1:0,t.button):e._pointerUpSecondary.value.set(1,t.button)}if("_pointerUpFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerUpFrame.value.set(t.stateFrame===2?1:0,t.button)}if("_pointerUpPrimaryFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===0?e._pointerUpPrimaryFrame.value.set(t.stateFrame===2?1:0,t.button):e._pointerUpPrimaryFrame.value.set(0,t.button)}if("_pointerUpAuxiliaryFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===1?e._pointerUpAuxiliaryFrame.value.set(t.stateFrame===2?1:0,t.button):e._pointerUpAuxiliaryFrame.value.set(0,t.button)}if("_pointerUpSecondaryFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;t.button===2?e._pointerUpSecondaryFrame.value.set(t.stateFrame===2?1:0,t.button):e._pointerUpSecondaryFrame.value.set(0,t.button)}if("_pointerEnter"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerEnter.value=t.viewportState===1?1:0}if("_pointerLeave"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerLeave.value=t.viewportState===0||t.viewportState===2?1:0}if("_pointerEnterFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerEnterFrame.value=t.viewportStateFrame===1?1:0}if("_pointerLeaveFrame"in e){const t="_pointerData"in r.renderer?r.renderer._pointerData:f;e._pointerLeaveFrame.value=t.viewportStateFrame===2?1:0}if("_keyboardTexture"in e){const t="_keyboardTexture"in r.renderer?r.renderer._keyboardTexture:null;e._keyboardTexture.value=t}},V=new s.Vector3(0,0,0),K=new s.Vector3(0,0,0),I=new s.Vector3(0,0,0);let D=new s.Vector2(0,0);var G={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(o,l,d){this.fn=o,this.context=l,this.once=d||!1}function a(o,l,d,g,x){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new i(d,g||o,x),y=t?t+l:l;return o._events[y]?o._events[y].fn?o._events[y]=[o._events[y],v]:o._events[y].push(v):(o._events[y]=v,o._eventsCount++),o}function m(o,l){--o._eventsCount==0?o._events=new n:delete o._events[l]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var o=[],l,d;if(this._eventsCount===0)return o;for(d in l=this._events)e.call(l,d)&&o.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(l)):o},h.prototype.listeners=function(o){var l=t?t+o:o,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var g=0,x=d.length,v=new Array(x);g<x;g++)v[g]=d[g].fn;return v},h.prototype.listenerCount=function(o){var l=t?t+o:o,d=this._events[l];return d?d.fn?1:d.length:0},h.prototype.emit=function(o,l,d,g,x,v){var y=t?t+o:o;if(!this._events[y])return!1;var u=this._events[y],T=arguments.length,P,_;if(u.fn){switch(u.once&&this.removeListener(o,u.fn,void 0,!0),T){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,l),!0;case 3:return u.fn.call(u.context,l,d),!0;case 4:return u.fn.call(u.context,l,d,g),!0;case 5:return u.fn.call(u.context,l,d,g,x),!0;case 6:return u.fn.call(u.context,l,d,g,x,v),!0}for(_=1,P=new Array(T-1);_<T;_++)P[_-1]=arguments[_];u.fn.apply(u.context,P)}else{var he=u.length,O;for(_=0;_<he;_++)switch(u[_].once&&this.removeListener(o,u[_].fn,void 0,!0),T){case 1:u[_].fn.call(u[_].context);break;case 2:u[_].fn.call(u[_].context,l);break;case 3:u[_].fn.call(u[_].context,l,d);break;case 4:u[_].fn.call(u[_].context,l,d,g);break;default:if(!P)for(O=1,P=new Array(T-1);O<T;O++)P[O-1]=arguments[O];u[_].fn.apply(u[_].context,P)}}return!0},h.prototype.on=function(o,l,d){return a(this,o,l,d,!1)},h.prototype.once=function(o,l,d){return a(this,o,l,d,!0)},h.prototype.removeListener=function(o,l,d,g){var x=t?t+o:o;if(!this._events[x])return this;if(!l)return m(this,x),this;var v=this._events[x];if(v.fn)v.fn===l&&(!g||v.once)&&(!d||v.context===d)&&m(this,x);else{for(var y=0,u=[],T=v.length;y<T;y++)(v[y].fn!==l||g&&!v[y].once||d&&v[y].context!==d)&&u.push(v[y]);u.length?this._events[x]=u.length===1?u[0]:u:m(this,x)}return this},h.prototype.removeAllListeners=function(o){var l;return o?(l=t?t+o:o,this._events[l]&&m(this,l)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,r.exports=h})(G);const se=G.exports;class le{constructor(){b(this,"events"),b(this,"requests",[]),b(this,"cache",{}),this.events=new se}load(e){this.requests.includes(e)||(this.requests.push(e),fetch(e).then(t=>t.json()).then(t=>{Z("graph.load",{url:e,href:window.location.href}),this.cache[e]=t,this.events.emit("load",{url:e,data:t})}))}}const k=r=>r instanceof Date,de=r=>Object.keys(r).length===0,C=r=>r!=null&&typeof r=="object",Y=(r,...e)=>Object.prototype.hasOwnProperty.call(r,...e),W=r=>C(r)&&de(r),ce=()=>Object.create(null),$=(r,e)=>{if(r===e)return{};if(!C(r)||!C(e))return e;const t=Object.keys(r).reduce((n,i)=>(Y(e,i)||(n[i]=void 0),n),ce());return k(r)||k(e)?r.valueOf()==e.valueOf()?{}:e:Object.keys(e).reduce((n,i)=>{if(!Y(r,i))return n[i]=e[i],n;const a=$(r[i],e[i]);return W(a)&&!k(a)&&(W(r[i])||!W(e[i]))||(n[i]=a),n},t)},ue=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},j=r=>ue(r)?Object.keys(r).reduce((e,t)=>{if(t==="__esModule")return e;const n=Object.getOwnPropertyDescriptor(r,t),i=n&&"get"in n,a=r[t];return i?Object.defineProperty(e,t,n):e[t]=j(a),e},{}):Array.isArray(r)?r.map(e=>j(e)):r;oe();const F=new le,q=306;c.NodeToyCullMode=void 0,function(r){r.Front="front",r.Back="back",r.None="none"}(c.NodeToyCullMode||(c.NodeToyCullMode={})),c.NodeToyMaterialType=void 0,function(r){r.Standard="standard",r.Physical="physical",r.Unlit="unlit",r.Image="image"}(c.NodeToyMaterialType||(c.NodeToyMaterialType={})),c.NodeToyRenderType=void 0,function(r){r.Opaque="opaque",r.Transparent="transparent"}(c.NodeToyRenderType||(c.NodeToyRenderType={}));const S=class extends s.ShaderMaterial{constructor(e){super();M(this,"verbose",!1);M(this,"resetUniformByName",e=>{this.resetUniformsByName([e])});M(this,"resetUniformsByName",e=>{for(let t=0;t<e.length;t++){const n=e[t];for(let i=0;i<this._data.uniforms.length;i++){const a=this._data.uniforms[i];if(a.name===n){this.uniforms[a.name]={value:z(this._url,a.type,a.value),type:a.type};break}}}});M(this,"_fullURL",null);M(this,"_url",null);M(this,"_data",null);M(this,"_parameters",{});M(this,"_cullMode",c.NodeToyCullMode.Back);M(this,"_type",c.NodeToyMaterialType.Unlit);M(this,"_options",{});M(this,"_envUUID",null);this.toneMapped=!1,this.flatShading=!1,this.transparent=!0,this.onBeforeRender=this.onBeforeRender,this.normalMap=new s.Texture,this.tangentSpaceNormalMap=new s.Texture,this.aoMap=new s.Texture,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.depthTest=!0,this.depthWrite=!0,this.envMapIntensity=1,this.side=s.FrontSide,this.vertexShader=s.ShaderLib.standard.vertexShader,this.fragmentShader=s.ShaderLib.standard.fragmentShader,this.defines={STANDARD:"",USE_NORMALMAP:"",USE_TANGENT:"",TANGENTSPACE_NORMALMAP:""},this.uniforms=j(s.ShaderLib.physical.uniforms),this.uniforms.spotShadowMatrix={value:[new s.Matrix4]},this.lights=!0,this.isShaderMaterial=!0,this.isMeshStandardMaterial=!1,this.type="ShaderMaterial",this.combine=s.MultiplyOperation,e&&("verbose"in e&&(this.verbose=e.verbose),"url"in e&&(this.url=e.url),"toneMapped"in e&&(this.toneMapped=e.toneMapped),"flatShading"in e&&(this.flatShading=e.flatShading),"transparent"in e&&(this.transparent=e.transparent),"cullMode"in e&&(this.cullMode=e.cullMode),this._parameters=e.parameters?e.parameters:null,"polygonOffset"in e&&(this.polygonOffset=e.polygonOffset),"polygonOffsetFactor"in e&&(this.polygonOffsetFactor=e.polygonOffsetFactor),"depthTest"in e&&(this.depthTest=e.depthTest),"depthWrite"in e&&(this.depthWrite=e.depthWrite),"envMapIntensity"in e&&(this.envMapIntensity=e.envMapIntensity),"data"in e&&(this.data=e.data),this._options=e),F.events.on("load",t=>{t.url===this._fullURL&&this.loadShader(t.data)})}static tick(){S._time.deltaTime=S._clock.getDelta(),S._time.time+=S._time.deltaTime}get cullMode(){return this._cullMode}set cullMode(e){this._cullMode=e,this.side=this.getTHREECullMode(e)}recompile(){this.version++,this.dispose()}clone(){return new this.constructor().copy(this)}copy(e){return super.copy(e),this._url=e._url,this._data=e._data,this.verbose=e.verbose,this._parameters&&(this._parameters=U({},e._parameters)),this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.uniforms=j(e.uniforms),this.recompile(),this}get url(){return this._url}set url(e){if(this._url=e,e){const t=this._fullURL=ie(e);this.verbose&&console.log(`[NodeToy] loading graph... | url: ${t}`),t in F.cache?this.loadShader(F.cache[t]):F.load(t)}else console.warn("[NodeToy] Missing material graph URL. Cannot load shader.")}get data(){return this._data}set data(e){if(!e){console.warn("[NodeToy] Missing material graph data. Cannot load shader.");return}this.verbose&&console.log("[NodeToy] seting graph data... | data:",e),this.loadShader(e)}get parameters(){return this._parameters}set parameters(e){if(this._parameters=e,this._data){const t=this._data.uniforms,n=j(this.uniforms),i=B(this.url,this.uniforms,t,e),a=Object.keys($(n,i));for(let m=0;m<a.length;m++){const h=a[m];this.uniforms[h]=i[h]}}}updateUniforms(e){let t=[];if(Object.assign(t,e),this._parameters!==null)for(const n in this._parameters)for(let i=0;i<t.length;i++)n===t[i].name&&(t[i].value=this._parameters[n]);return t}loadShader(e){this.verbose&&console.log("[NodeToy] graph loaded.",e,B(this.url,this.uniforms,e.uniforms)),this._data=e,this.vertexShader=e.vertex,this.fragmentShader=e.fragment;const t=this.updateUniforms(e.uniforms);this.uniforms=B(this.url,this.uniforms,t),this.recompile(),"cullMode"in e&&!("cullMode"in this._options)&&(this.cullMode=e.cullMode),"lightModel"in e&&(this._type=e.lightModel),"renderType"in e&&(this.transparent=e.renderType===c.NodeToyRenderType.Transparent)}onBeforeRender(e,t,n,i,a){const m={camera:n,object:a,renderer:e,scene:t,light:null,time:S._time.time,deltaTime:S._time.deltaTime};if(e._rendererDOM||(e._rendererDOM=new re(e)),this.uniforms&&ae(m,this.uniforms),t.environment&&this._type!==c.NodeToyMaterialType.Unlit){if(this._envUUID!=t.environment.uuid){this._envUUID=t.environment.uuid;const h=t.environment.clone();h.mapping=s.CubeUVReflectionMapping,this.envMap=h,this.envMap.mapping=s.CubeUVReflectionMapping,this.envMapMode=q,this.uniforms.envMap.value=h,this.uniforms.envMapIntensity.value=this.envMapIntensity}this.defines={STANDARD:"",USE_NORMALMAP:"",USE_ENVMAP:"",ENVMAP_TYPE_CUBE_UV:"",USE_TANGENT:"",TANGENTSPACE_NORMALMAP:""}}else this.envMap=null,"envMap"in this.uniforms&&(this.uniforms.envMap.value=null),this.defines={STANDARD:"",USE_NORMALMAP:"",USE_TANGENT:"",TANGENTSPACE_NORMALMAP:""};t.fog&&(this.defines.USE_FOG="")}getTHREECullMode(e){return e===c.NodeToyCullMode.None?s.DoubleSide:e===c.NodeToyCullMode.Front?s.BackSide:s.FrontSide}};let E=S;M(E,"_bindDOMEvents",()=>{}),M(E,"_time",{time:0,deltaTime:0}),M(E,"_clock",new s.Clock),c.CubeUVReflectionMapping=q,c.NodeToyMaterial=E,Object.defineProperty(c,"__esModule",{value:!0}),c[Symbol.toStringTag]="Module"});
